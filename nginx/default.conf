

# server {
#     listen 80;
#     server_name timeflow.space;

#     location /.well-known/acme-challenge/ {
#         root /var/www/certbot;
#     }
# }

# server {
#     listen 80;
#     server_name api.timeflow.space;

#     location /.well-known/acme-challenge/ {
#         root /var/www/certbot;
#     }
# }

server {
    listen 443 ssl;
    server_name api.timeflow.space;

    ssl_certificate /etc/letsencrypt/live/api.timeflow.space-0001/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.timeflow.space-0001/privkey.pem;

    location / {
        proxy_pass http://backend:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

server {
    listen 443 ssl;
    server_name timeflow.space www.timeflow.space;

    ssl_certificate /etc/letsencrypt/live/timeflow.space/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/timeflow.space/privkey.pem;

    location / {
        proxy_pass http://frontend:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}


# Saving debug log to /var/log/letsencrypt/letsencrypt.log
# Requesting a certificate for api.timeflow.space

# Successfully received certificate.
# Certificate is saved at: /etc/letsencrypt/live/api.timeflow.space-0001/fullchain.pem
# Key is saved at:         /etc/letsencrypt/live/api.timeflow.space-0001/privkey.pem
# This certificate expires on 2025-10-29.
# These files will be updated when the certificate renews.

# NEXT STEPS:
# - The certificate will need to be renewed before it expires. Certbot can automatically renew the certificate in the background, but you may need to take steps to enable that functionality. See https://certbot.org/renewal-setup for instructions.

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# If you like Certbot, please consider supporting our work by:
#  * Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
#  * Donating to EFF:                    https://eff.org/donate-le
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -